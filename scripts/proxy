#!/bin/bash

if [[ -n "$SSH_TARGET_HOST" ]]; then
  echo "Using remote mode!"
  exec ./scripts/ssh "cd" "$SSH_TARGET_DIR" "&&" exec ./scripts/proxy "$@"
fi

if [[ -z "$HOST" ]]; then
  case "$(uname -s)" in
    Linux)
      export HOST=$(hostname -I | cut -d' ' -f1)
      ;;

    Darwin)
      export HOST=$(ipconfig getifaddr en0 || ipconfig getifaddr en1 || ipconfig getifaddr en2)
      ;;
  esac
fi

if [[ -z "$HOST" ]]; then
  echo "Could not detect IP address. Consider setting this as an environment variable: export HOST=<my-ip-address>"
  exit 1
fi

exec "$@"
